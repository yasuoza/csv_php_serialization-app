// Generated by CoffeeScript 1.6.2
(function() {
  jQuery(function($) {
    var $contents;

    $contents = $('#contents');
    return $('#fileupload').fileupload({
      dataType: 'json',
      dropZone: $('#drop-zone'),
      add: function(e, data) {
        var filename, flash;

        e.preventDefault();
        filename = data.files[0].name;
        if (!filename.match(/\.csv$/)) {
          (flash = $(".flash-container .alert-error")).fadeIn().click(function() {
            return $(this).fadeOut();
          });
          setTimeout((function() {
            return flash.fadeOut();
          }), 3000);
          return;
        }
        $('#progress, #serialized-text, #copy-serialized').hide();
        $('#serialized-text').text('');
        $('#upload-btn, #filename').show();
        data.context = $('#upload-btn').click(function() {
          data.context = $(this).hide();
          return data.submit();
        });
        return $('#filename').text(filename);
      },
      submit: function(e, data) {
        return $('#progress').show();
      },
      progress: function(e, data) {
        var progress;

        progress = parseInt(data.loaded / data.total * 100, 10);
        return $('#progress .bar').css('width', "" + progress + "%");
      },
      done: function(e, data) {
        $('#serialized-text').text(data.result.serializedText).focus().select();
        $('#serialized-text, #copy-serialized').show();
        return $('#copy-serialized').zclip({
          path: '/javascripts/ZeroClipboard.swf',
          copy: $('#serialized-text').text(),
          afterCopy: function() {
            var flash;

            (flash = $(".flash-container .alert-info")).fadeIn().click(function() {
              return $(this).fadeOut();
            });
            return setTimeout((function() {
              return flash.fadeOut();
            }), 3000);
          }
        });
      }
    });
  });

}).call(this);
